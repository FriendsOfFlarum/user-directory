module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=23)}([function(e,t){e.exports=flarum.core.compat.app},function(e,t){e.exports=flarum.core.compat.extend},function(e,t){e.exports=flarum.core.compat.Component},function(e,t){e.exports=flarum.core.compat["components/IndexPage"]},function(e,t){e.exports=flarum.core.compat["components/LinkButton"]},function(e,t){e.exports=flarum.core.compat["utils/ItemList"]},function(e,t){e.exports=flarum.core.compat["components/Button"]},function(e,t){e.exports=flarum.core.compat["components/LoadingIndicator"]},function(e,t){e.exports=flarum.core.compat["helpers/listItems"]},function(e,t){e.exports=flarum.core.compat.Model},,function(e,t){e.exports=flarum.core.compat["components/UsersSearchSource"]},function(e,t){e.exports=flarum.core.compat["components/Page"]},function(e,t){e.exports=flarum.core.compat["components/DiscussionComposer"]},function(e,t){e.exports=flarum.core.compat["components/LogInModal"]},function(e,t){e.exports=flarum.core.compat["components/Select"]},function(e,t){e.exports=flarum.core.compat["components/SelectDropdown"]},function(e,t){e.exports=flarum.core.compat["components/Placeholder"]},function(e,t){e.exports=flarum.core.compat["components/UserCard"]},function(e,t){e.exports=flarum.core.compat["utils/KeyboardNavigatable"]},function(e,t){e.exports=flarum.core.compat["models/Group"]},function(e,t){e.exports=flarum.core.compat["helpers/icon"]},,function(e,t,r){"use strict";r.r(t),r.d(t,"UserDirectoryPage",(function(){return X})),r.d(t,"components",(function(){return ne})),r.d(t,"searchTypes",(function(){return oe}));var n=r(1),o=r(0),s=r.n(o),i=r(11),a=r.n(i),c=r(4),u=r.n(c),l=r(3),f=r.n(l);function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var d=r(12),h=r.n(d),y=r(5),v=r.n(y),g=r(8),b=r.n(g),x=r(13),w=r.n(x),F=r(14),I=r.n(F),P=r(15),_=r.n(P),N=r(6),S=r.n(N),D=r(16),L=r.n(D),U=r(2),q=r.n(U),k=r(7),R=r.n(k),O=r(17),C=r.n(O),T=r(18),j=r.n(T),A=function(e){function t(){return e.apply(this,arguments)||this}return p(t,e),t.prototype.view=function(){var e=this.props.user,t=j.a.component({user:e,className:"UserCard--directory",controlsButtonClassName:"Button Button--icon Button--flat"});return m("div",{className:"User"},t)},t}(q.a),B=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var r=t.prototype;return r.init=function(){this.loading=!0,this.moreResults=!1,this.users=[],this.refresh()},r.view=function(){var e,t=this.props.params;if(this.loading?e=R.a.component():this.moreResults&&(e=S.a.component({children:s.a.translator.trans("core.forum.discussion_list.load_more_button"),className:"Button",onclick:this.loadMore.bind(this)})),0===this.users.length&&!this.loading){var r=s.a.translator.trans("core.forum.discussion_list.empty_text");return m("div",{className:"DiscussionList"},C.a.component({text:r}))}return m("div",{className:"UserDirectoryList"},this.users.map((function(e){return m("div",{key:e.username(),"data-id":e.username()},A.component({user:e,params:t}))})),m("div",{key:"load-more",className:"UserDirectoryList-loadMore"},e))},r.requestParams=function(){var e={include:[],filter:{}};return e.sort=this.sortMap()[this.props.params.sort],this.props.params.q&&(e.filter.q=this.props.params.q),e},r.sortMap=function(){var e={};return this.props.params.q?e.relevance="":e.default="",e.username_az="username",e.username_za="-username",e.newest="-joinedAt",e.oldest="joinedAt",e.seen_recent="-lastSeenAt",e.seen_oldest="lastSeenAt",e.most_discussions="-discussionCount",e.least_discussions="discussionCount",e},r.refresh=function(e){var t=this;return void 0===e&&(e=!0),e&&(this.loading=!0,this.users=[]),this.loadResults(0).then((function(e){t.users=[],t.parseResults(e)}),(function(){t.loading=!1,m.redraw()}))},r.loadResults=function(e){var t=s.a.preloadedApiDocument();if(t)return m.deferred().resolve(t).promise;var r=this.requestParams();return r.page={offset:e},r.include=r.include.join(","),s.a.store.find("users",r)},r.loadMore=function(){this.loading=!0,this.loadResults(this.users.length).then(this.parseResults.bind(this))},r.parseResults=function(e){return[].push.apply(this.users,e),this.loading=!1,this.moreResults=!!e.payload.links.next,m.lazyRedraw(),e},r.removeUser=function(e){var t=this.users.indexOf(e);-1!==t&&this.users.splice(t,1)},r.addUser=function(e){this.users.unshift(e)},t}(q.a),M=r(19),z=r.n(M),K=function(){function e(){this.suggestions=[],this.loading=!1}var t=e.prototype;return t.resourceType=function(){},t.search=function(e){},t.renderKind=function(e){},t.renderLabel=function(e){},t.applyFilter=function(e,t){},t.initializeFromParams=function(e){},e}(),E=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var r=t.prototype;return r.resourceType=function(){return"fof-user-directory-text"},r.search=function(e){this.suggestions=e?[s.a.store.createRecord("fof-user-directory-text",{attributes:{text:e}})]:[]},r.renderKind=function(){return s.a.translator.trans("fof-user-directory.forum.search.kinds.text")},r.renderLabel=function(e){return m(".UserDirectorySearchLabel",e.text())},r.applyFilter=function(e,t){e.q=e.q?e.q+" ":"",e.q+=t.text()},r.initializeFromParams=function(e){return e.q?Promise.resolve(e.q.split(" ").filter((function(e){return-1===e.indexOf(":")})).map((function(e){return s.a.store.createRecord("fof-user-directory-text",{attributes:{text:e}})}))):Promise.resolve([])},t}(K),G=r(20),H=r.n(G),J=r(21),Q=r.n(J),V=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var r=t.prototype;return r.resourceType=function(){return"groups"},r.search=function(e){var t=this;this.suggestions=[],e&&(e=e.toLowerCase(),s.a.store.all("groups").forEach((function(r){r.id()!==H.a.GUEST_ID&&(-1===r.nameSingular().toLowerCase().indexOf(e)&&-1===r.namePlural().toLowerCase().indexOf(e)||t.suggestions.push(r))})))},r.renderKind=function(){return s.a.translator.trans("fof-user-directory.forum.search.kinds.group")},r.renderLabel=function(e){return m(".UserDirectorySearchLabel",e.color()?{className:"colored",style:{backgroundColor:e.color()}}:{},[e.icon()?[Q()(e.icon())," "]:null,e.namePlural()])},r.applyFilter=function(e,t){e.q=e.q?e.q+" ":"",e.q+="group:"+t.namePlural()},r.initializeFromParams=function(e){if(!e.q)return Promise.resolve([]);var t=" "+e.q+" ",r=[];return s.a.store.all("groups").forEach((function(e){-1!==t.indexOf("group:"+e.namePlural())&&r.push(e)})),Promise.resolve(r)},t}(K),W=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var r=t.prototype;return r.init=function(){var t=this;e.prototype.init.call(this),this.searchIndex=0,this.navigator=new z.a,this.navigator.when((function(e){return"Tab"!==e.key||!!t.filter})).onUp((function(){t.searchIndex>0&&(t.searchIndex--,m.redraw())})).onDown((function(){t.searchIndex<t.allSuggestions().length-1&&(t.searchIndex++,m.redraw())})).onSelect((function(){t.filter?(t.selectResult(t.allSuggestions()[t.searchIndex]),m.redraw()):t.applyFiltering()})).onRemove((function(){t.appliedFilters.pop()})),this.availableFilters=this.filterTypes().toArray(),this.appliedFilters=[],this.filter="",this.focused=!1,this.availableFilters.forEach((function(e){e.initializeFromParams({sort:m.route.param("sort"),q:m.route.param("q")}).then((function(e){var r;(r=t.appliedFilters).push.apply(r,e),m.redraw()}))}))},r.filterTypes=function(){var e=new v.a;return e.add("text",new E,10),e.add("group",new V,20),e},r.filterForResource=function(e){return this.availableFilters.find((function(t){return t.resourceType()===e.data.type}))},r.recipientLabel=function(e){var t=this.filterForResource(e);return t?t.renderLabel(e):"[unknown]"},r.searchResultKind=function(e){var t=this.filterForResource(e);return t?t.renderKind(e):"[unknown]"},r.selectResult=function(e){e&&(this.appliedFilters.push(e),this.clearSuggestions())},r.clearSuggestions=function(){this.filter="",this.availableFilters.forEach((function(e){e.search("")}))},r.allSuggestions=function(){var e;return(e=[]).concat.apply(e,this.availableFilters.map((function(e){return e.suggestions})))},r.view=function(){var e=this,t=this.allSuggestions(),r=this.availableFilters.some((function(e){return e.loading}));return m(".Form-group",[m(".UserDirectorySearchInput.FormControl",{className:this.focused?"focus":""},[m("span.UserDirectorySearchInput-selected",this.appliedFilters.map((function(t,r){return m("span.UserDirectorySearchInput-filter",{onclick:function(){e.appliedFilters.splice(r,1),e.applyFiltering()},title:e.searchResultKind(t)},e.recipientLabel(t))}))),m("input.FormControl",{placeholder:s.a.translator.trans("fof-user-directory.forum.search.field.placeholder"),value:this.filter,oninput:m.withAttr("value",(function(t){e.filter=t,e.performNewSearch()})),onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:function(){e.focused=!0},onblur:function(){e.focused=!1}}),r?R.a.component({size:"tiny",className:"Button Button--icon Button--link"}):null,t.length?m("ul.Dropdown-menu",t.map((function(t,r){return m("li",{className:e.searchIndex===r?"active":"",onclick:function(){e.selectResult(t),e.applyFiltering()}},m("button[type=button]",[m("span.UserDirectorySearchKind",e.searchResultKind(t)),e.recipientLabel(t)]))}))):null])])},r.performNewSearch=function(){var e=this;this.searchIndex=0,this.availableFilters.forEach((function(t){t.search(e.filter)}))},r.applyFiltering=function(){var e=this,t={sort:m.route.param("sort")};this.appliedFilters.forEach((function(r){var n=e.filterForResource(r);n?n.applyFilter(t,r):console.warn("Cannot find filter class for resource",r)})),m.route(s.a.route("fof_user_directory",t))},t}(q.a),X=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var r=t.prototype;return r.init=function(){e.prototype.init.call(this),s.a.previous instanceof t&&(s.a.cache.fofUserDirectoryList=null);var r=this.params();s.a.cache.fofUserDirectoryList&&Object.keys(r).some((function(e){if(s.a.cache.fofUserDirectoryList.props.params[e]!==r[e])return s.a.cache.fofUserDirectoryList=null,!0})),s.a.cache.fofUserDirectoryList||(s.a.cache.fofUserDirectoryList=new B({params:r})),this.bodyClass="User--directory"},r.onunload=function(){s.a.cache.scrollTop=$(window).scrollTop()},r.view=function(){return m("div",{className:"IndexPage"},f.a.prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,b()(this.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},b()(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},b()(this.actionItems().toArray()))),s.a.cache.fofUserDirectoryList.render()))))},r.config=function(t,r){if(e.prototype.config.apply(this,arguments),!t){Object(n.extend)(r,"onunload",(function(){return $("#app").css("min-height","")})),s.a.setTitle(""),s.a.setTitleCount(0);var o=s.a.cache.scrollTop;$("#app").css("min-height",$(window).height());var i=function(){return $(window).scrollTop(o)};i(),setTimeout(i,1)}},r.sidebarItems=function(){var e=f.a.prototype.sidebarItems();return e.replace("nav",L.a.component({children:this.navItems(this).toArray(),buttonClassName:"Button",className:"App-titleControl"})),e},r.navItems=function(){var e=f.a.prototype.navItems(),t=this.stickyParams();return e.add("fof-user-directory",u.a.component({href:s.a.route("fof_user_directory",t),children:s.a.translator.trans("fof-user-directory.forum.page.nav"),icon:"far fa-address-book"}),85),e},r.viewItems=function(){var e=new v.a,t=s.a.cache.fofUserDirectoryList.sortMap(),r={};for(var n in t)r[n]=s.a.translator.trans("fof-user-directory.forum.page.sort."+n);return e.add("sort",_.a.component({options:r,value:this.params().sort||Object.keys(t)[0],onchange:this.changeSort.bind(this)})),e.add("search",W.component()),e},r.actionItems=function(){var e=new v.a;return e.add("refresh",S.a.component({title:s.a.translator.trans("core.forum.index.refresh_tooltip"),icon:"fas fa-sync",className:"Button Button--icon",onclick:function(){s.a.cache.fofUserDirectoryList.refresh(),s.a.session.user&&(s.a.store.find("users",s.a.session.user.id()),m.redraw())}})),e},r.searching=function(){return this.params().q},r.clearSearch=function(){var e=this.params();delete e.q,m.route(s.a.route(this.props.routeName,e))},r.changeSort=function(e){var t=this.params();e===Object.keys(s.a.cache.fofUserDirectoryList.sortMap())[0]?delete t.sort:t.sort=e,m.route(s.a.route(this.props.routeName,t))},r.stickyParams=function(){return{sort:m.route.param("sort"),q:m.route.param("q")}},r.params=function(){var e=this.stickyParams();return e.filter=m.route.param("filter"),e},r.newDiscussion=function(){var e=m.deferred();return s.a.session.user?this.composeNewDiscussion(e):s.a.modal.show(new I.a({onlogin:this.composeNewDiscussion.bind(this,e)})),e.promise},r.composeNewDiscussion=function(e){var t=new w.a({user:s.a.session.user});return s.a.composer.load(t),s.a.composer.show(),e.resolve(t),e.promise},t}(h.a);function Y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ee=r(9),te=r.n(ee),re=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Z(Y(t=e.call.apply(e,[this].concat(n))||this),"text",te.a.attribute("text")),t}return p(t,e),t}(te.a),ne={SearchField:W,UserDirectoryPage:X},oe={AbstractType:K,GroupFilter:V,TextFilter:E};s.a.initializers.add("fof-user-directory",(function(e){e.routes.fof_user_directory={path:"/users",component:X.component()},e.store.models["fof-user-directory-text"]=re,Object(n.extend)(a.a.prototype,"view",(function(t,r){t&&(r=r.toLowerCase(),t.splice(1,0,m("li",null,u.a.component({icon:"fas fa-search",children:e.translator.trans("fof-user-directory.forum.search.users_heading",{query:r}),href:e.route("fof_user_directory",{q:r})}))))})),Object(n.extend)(f.a.prototype,"navItems",(function(t){e.forum.attribute("canSeeUserDirectoryLink")&&t.add("fof-user-directory",u.a.component({href:e.route("fof_user_directory"),children:e.translator.trans("fof-user-directory.forum.page.nav"),icon:"far fa-address-book"}),85)}))}))}]);
//# sourceMappingURL=forum.js.map