module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=27)}([function(t,e){t.exports=flarum.core.compat["forum/app"]},function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var n=function(){function t(){}return t.prototype.sortMap=function(){return{username_az:"username",username_za:"-username",newest:"-joinedAt",oldest:"joinedAt",most_discussions:"-discussionCount",least_discussions:"discussionCount"}},t}()},function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e){t.exports=flarum.core.compat["common/Component"]},function(t,e){t.exports=flarum.core.compat["common/utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["common/components/LinkButton"]},function(t,e){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["forum/components/UserCard"]},function(t,e){t.exports=flarum.core.compat["common/helpers/icon"]},function(t,e){t.exports=flarum.core.compat["common/helpers/listItems"]},function(t,e){t.exports=flarum.core.compat["forum/components/IndexPage"]},function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e){t.exports=flarum.core.compat["common/Model"]},function(t,e){t.exports=flarum.core.compat["common/components/UsersSearchSource"]},function(t,e){t.exports=flarum.core.compat["common/components/IndexPage"]},function(t,e){t.exports=flarum.core.compat["common/components/Page"]},function(t,e){t.exports=flarum.core.compat["common/components/Select"]},function(t,e){t.exports=flarum.core.compat["common/components/SelectDropdown"]},function(t,e){t.exports=flarum.core.compat["common/components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["common/components/Placeholder"]},function(t,e){t.exports=flarum.core.compat["common/utils/humanTime"]},function(t,e){t.exports=flarum.core.compat["common/utils/withAttr"]},function(t,e){t.exports=flarum.core.compat["common/utils/KeyboardNavigatable"]},function(t,e){t.exports=flarum.core.compat["utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["common/models/Group"]},function(t,e){t.exports=flarum.core.compat["common/components/Separator"]},,function(t,e,r){"use strict";r.r(e),r.d(e,"UserDirectoryPage",(function(){return lt})),r.d(e,"UserDirectoryList",(function(){return K})),r.d(e,"UserDirectoryListItem",(function(){return E})),r.d(e,"UserDirectoryState",(function(){return J})),r.d(e,"SortMap",(function(){return H.a})),r.d(e,"CheckableButton",(function(){return W})),r.d(e,"components",(function(){return dt})),r.d(e,"searchTypes",(function(){return ht}));var n=r(11),o=r(0),s=r.n(o),a=r(13),i=r.n(a),u=r(5),c=r.n(u),l=r(14),f=r.n(l);function p(){return(p=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,d(t,e)}var y=r(15),v=r.n(y),g=r(4),b=r.n(g),x=r(9),F=r.n(x),S=r(10),P=r.n(S),w=r(16),q=r.n(w),I=r(2),_=r.n(I),N=r(17),D=r.n(N),k=r(18),U=r.n(k),L=r(3),B=r.n(L),C=r(6),G=r.n(C),R=r(19),j=r.n(R),O=r(7),A=r.n(O),T=r(20),M=r.n(T),z=function(t){function e(){return t.apply(this,arguments)||this}return h(e,t),e.prototype.infoItems=function(){var t=new b.a,e=this.attrs.user;return t.add("joined",app.translator.trans("core.forum.user.joined_date_text",{ago:M()(e.joinTime())})),t},e}(A.a),E=function(t){function e(){return t.apply(this,arguments)||this}return h(e,t),e.prototype.view=function(t){var e=this.attrs,r=e.user,n=e.useSmallCards,o={user:r,className:"UserCard--directory"+(n?" UserCard--small":""),controlsButtonClassName:"Button Button--icon Button--flat"};return m("div",{className:"User"},n?z.component(o):A.a.component(o))},e}(B.a),K=function(t){function e(){return t.apply(this,arguments)||this}return h(e,t),e.prototype.view=function(){var t,e=this.attrs.state,r=e.getParams(),n=s.a.forum.attribute("userDirectorySmallCards");if(e.isLoading()?t=G.a.component():e.moreResults&&(t=_.a.component({className:"Button",onclick:e.loadMore.bind(e)},s.a.translator.trans("fof-user-directory.forum.page.load_more_button"))),e.empty()){var o=s.a.translator.trans("fof-user-directory.forum.page.empty_text");return m("div",{className:"DiscussionList"},j.a.component({text:o}))}return m("div",{className:"UserDirectoryList"+(e.isSearchResults()?" UserDirectoryList--searchResults":"")+(n?" UserDirectoryList--small-cards":"")},m("ul",{className:"UserDirectoryList-users"},e.users.map((function(t){return m("li",{key:t.id(),"data-id":t.id()},E.component({user:t,params:r,useSmallCards:n}))}))),m("div",{className:"UserDirectoryList-loadMore"},t))},e}(B.a),H=r(1),J=function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e=window.app),this.params=t,this.app=e,this.users=[],this.moreResults=!1,this.loading=!1,this.qBuilder={}}var e=t.prototype;return e.requestParams=function(){var t={include:[],filter:{}},e=this.params.sort||app.forum.attribute("userDirectoryDefaultSort");return t.sort=this.sortMap()[e],this.params.q&&(t.filter.q=this.params.q),t},e.sortMap=function(){return p({default:""},(new H.a).sortMap())},e.getParams=function(){return this.params},e.clear=function(){this.users=[],m.redraw()},e.refreshParams=function(t){var e=this;if(!this.hasUsers()||Object.keys(t).some((function(r){return e.getParams()[r]!==t[r]}))){this.params=t,t.qBuilder&&(Object.assign(this.qBuilder,t.qBuilder||{}),this.params.q=Object.values(this.qBuilder).join(" ").trim()),this.params.q,this.refresh()}},e.refresh=function(){var t=this;return this.loading=!0,this.clear(),this.loadResults().then((function(e){t.users=[],t.parseResults(e)}),(function(){t.loading=!1,m.redraw()}))},e.loadResults=function(t){var e=this.app.preloadedApiDocument();if(e)return Promise.resolve(e);var r=this.requestParams();return r.page={offset:t},r.include=r.include.join(","),this.app.store.find("users",r)},e.loadMore=function(){this.loading=!0,this.loadResults(this.users.length).then(this.parseResults.bind(this))},e.parseResults=function(t){var e;return(e=this.users).push.apply(e,t),this.loading=!1,this.moreResults=!!t.payload.links&&!!t.payload.links.next,m.redraw(),t},e.hasUsers=function(){return this.users.length>0},e.isLoading=function(){return this.loading},e.isSearchResults=function(){return!!this.params.q},e.empty=function(){return!this.hasUsers()&&!this.isLoading()},t}(),Q=r(8),V=r.n(Q),W=function(t){function e(){return t.apply(this,arguments)||this}return h(e,t),e.prototype.getButtonContent=function(e){var r=t.prototype.getButtonContent.call(this,e);return this.attrs.checked&&r.push(V()("fas fa-check",{className:"Button-icon ButtonCheck"})),r},e}(_.a),X=r(21),Y=r.n(X),Z=r(22),$=r.n(Z),tt=r(23),et=r.n(tt),rt=function(){function t(){this.suggestions=[],this.loading=!1}var e=t.prototype;return e.resourceType=function(){},e.search=function(t){},e.renderKind=function(t){},e.renderLabel=function(t){},e.applyFilter=function(t,e){},e.initializeFromParams=function(t){},t}(),nt=function(t){function e(){return t.apply(this,arguments)||this}h(e,t);var r=e.prototype;return r.resourceType=function(){return"fof-user-directory-text"},r.search=function(t){this.suggestions=t?[s.a.store.createRecord("fof-user-directory-text",{attributes:{text:t}})]:[]},r.renderKind=function(){return s.a.translator.trans("fof-user-directory.forum.search.kinds.text")},r.renderLabel=function(t){return m(".UserDirectorySearchLabel",t.text())},r.applyFilter=function(t,e){t.q=t.q?t.q+" ":"",t.q+=e.text()},r.initializeFromParams=function(t){return t.q?Promise.resolve(t.q.split(" ").filter((function(t){return-1===t.indexOf(":")})).map((function(t){return s.a.store.createRecord("fof-user-directory-text",{attributes:{text:t}})}))):Promise.resolve([])},e}(rt),ot=r(24),st=r.n(ot),at=function(t){function e(){return t.apply(this,arguments)||this}h(e,t);var r=e.prototype;return r.resourceType=function(){return"groups"},r.search=function(t){var e=this;this.suggestions=[],t&&(t=t.toLowerCase(),s.a.store.all("groups").forEach((function(r){r.id()!==st.a.GUEST_ID&&(-1===r.nameSingular().toLowerCase().indexOf(t)&&-1===r.namePlural().toLowerCase().indexOf(t)||e.suggestions.push(r))})))},r.renderKind=function(){return s.a.translator.trans("fof-user-directory.forum.search.kinds.group")},r.renderLabel=function(t){return m(".UserDirectorySearchLabel",t.color()?{className:"colored",style:{backgroundColor:t.color()}}:{},[t.icon()?[V()(t.icon())," "]:null,t.namePlural()])},r.applyFilter=function(t,e){t.q=t.q?t.q+" ":"",t.q+="group:"+e.id()},r.initializeFromParams=function(t){if(!t.q)return Promise.resolve([]);var e=" "+t.q+" ",r=[];return s.a.store.all("groups").forEach((function(t){-1!==e.indexOf("group:"+t.id())&&r.push(t)})),Promise.resolve(r)},e}(rt),it=function(t){function e(){return t.apply(this,arguments)||this}h(e,t);var r=e.prototype;return r.oninit=function(e){var r=this;t.prototype.oninit.call(this,e),this.searchIndex=0,this.navigator=new $.a,this.navigator.when((function(t){return"Tab"!==t.key||!!r.filter})).onUp((function(){r.searchIndex>0&&(r.searchIndex--,m.redraw())})).onDown((function(){r.searchIndex<r.allSuggestions().length-1&&(r.searchIndex++,m.redraw())})).onSelect((function(){r.filter?(r.selectResult(r.allSuggestions()[r.searchIndex]),m.redraw()):r.applyFiltering()})).onRemove((function(){r.appliedFilters.pop()})),this.availableFilters=this.filterTypes().toArray(),this.appliedFilters=[],this.filter="",this.focused=!1,this.availableFilters.forEach((function(t){t.initializeFromParams({sort:m.route.param("sort"),q:m.route.param("q")}).then((function(t){var e;(e=r.appliedFilters).push.apply(e,t),m.redraw()}))}))},r.view=function(){var t=this,e=this.allSuggestions(),r=this.availableFilters.some((function(t){return t.loading}));return m("div",{className:"Form-group Usersearchbox"},m("div",{className:"UserDirectorySearchInput FormControl "+(this.focused?"focus":"")},m("span",{className:"UserDirectorySearchInput-selected"},this.appliedFilters.map((function(e,r){return m("span",{className:"UserDirectorySearchInput-filter",onclick:function(){t.appliedFilters.splice(r,1),t.applyFiltering()},title:t.searchResultKind(e)},t.recipientLabel(e))}))),m("input",{className:"FormControl",placeholder:s.a.translator.trans("fof-user-directory.forum.search.field.placeholder"),value:this.filter,oninput:Y()("value",(function(e){t.filter=e,t.performNewSearch()})),onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:function(){t.focused=!0},onblur:function(){t.focused=!1}}),r&&m(G.a,null),!!e.length&&m("ul",{className:"Dropdown-menu"},e.map((function(e,r){return m("li",{className:t.searchIndex===r?"active":"",onclick:function(){t.selectResult(e),t.applyFiltering()}},m("button",{type:"button"},m("span",{className:"UserDirectorySearchKind"},t.searchResultKind(e)),t.recipientLabel(e)))})))))},r.filterTypes=function(){var t=new et.a;return t.add("text",new nt,10),t.add("group",new at,20),t},r.filterForResource=function(t){return this.availableFilters.find((function(e){return e.resourceType()===t.data.type}))},r.recipientLabel=function(t){var e=this.filterForResource(t);return e?e.renderLabel(t):"[unknown]"},r.searchResultKind=function(t){var e=this.filterForResource(t);return e?e.renderKind(t):"[unknown]"},r.selectResult=function(t){t&&(this.appliedFilters.push(t),this.clearSuggestions())},r.clearSuggestions=function(){this.filter="",this.availableFilters.forEach((function(t){t.search("")}))},r.allSuggestions=function(){var t;return(t=[]).concat.apply(t,this.availableFilters.map((function(t){return t.suggestions})))},r.performNewSearch=function(){var t=this;this.searchIndex=0,this.availableFilters.forEach((function(e){e.search(t.filter)})),this.attrs.state.refreshParams(p({},this.attrs.state.getParams(),{qBuilder:this.qBuilder()}))},r.qBuilder=function(t){var e=this;return void 0===t&&(t={}),this.appliedFilters.forEach((function(r){var n=e.filterForResource(r);n?n.applyFilter(t,r):console.warn("Cannot find filter class for resource",r)})),{filter:this.filter+" "+(t.q||"")}},r.applyFiltering=function(){var t={sort:m.route.param("sort")};this.qBuilder(t),m.route.set(s.a.route("fof_user_directory",t))},e}(B.a),ut=r(25),ct=r.n(ut),lt=function(t){function e(){return t.apply(this,arguments)||this}h(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.state=new J({}),this.state.refreshParams(s.a.search.params()),this.bodyClass="User--directory";var r,n,o=[];(this.params().q&&Array.from(this.params().q.matchAll(/group:([\d,]+)/g)).forEach((function(t){o.push(t[1])})),this.enabledGroupFilters=o.join(",").split(",").filter((function(t){return t})),this.enabledSpecialGroupFilters=[],s.a.initializers.has("flarum-suspend")&&s.a.forum.attribute("hasSuspendPermission"))&&(null!=(r=this.params())&&null!=(n=r.q)&&n.includes("is:suspended")&&(this.enabledSpecialGroupFilters["flarum-suspend"]="is:suspended"));s.a.history.push("users",s.a.translator.trans("fof-user-directory.forum.header.back_to_user_directory_tooltip"))},r.view=function(){return m("div",{className:"IndexPage"},P.a.prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,F()(this.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},F()(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},F()(this.actionItems().toArray()))),m(K,{state:this.state})))))},r.sidebarItems=function(){var t=P.a.prototype.sidebarItems();return t.replace("nav",D.a.component({buttonClassName:"Button",className:"App-titleControl"},this.navItems().toArray())),t},r.navItems=function(){var t=P.a.prototype.navItems(),e=this.stickyParams();return t.add("fof-user-directory",c.a.component({href:s.a.route("fof_user_directory",e),icon:"far fa-address-book"},s.a.translator.trans("fof-user-directory.forum.page.nav")),85),t},r.viewItems=function(){var t=new b.a,e=this.state.sortMap(),r={};for(var n in e)r[n]=s.a.translator.trans("fof-user-directory.lib.sort."+n);return t.add("sort",q.a.component({options:r,value:this.state.getParams().sort||s.a.forum.attribute("userDirectoryDefaultSort"),onchange:this.changeParams.bind(this)})),t.add("filterGroups",U.a.component({caretIcon:"fas fa-filter",label:s.a.translator.trans("fof-user-directory.forum.page.filter_button"),buttonClassName:"FormControl",className:"GroupFilterDropdown"},this.groupItems().toArray())),t.add("search",it.component({state:this.state})),t},r.groupItems=function(){var t=this,e=new b.a;return s.a.store.all("groups").filter((function(t){return"2"!==t.id()&&"3"!==t.id()})).forEach((function(r){e.add(r.namePlural(),W.component({className:"GroupFilterButton",icon:r.icon(),checked:t.enabledGroupFilters.includes(r.id()),onclick:function(){var e=r.id();t.enabledGroupFilters.includes(e)?t.enabledGroupFilters=t.enabledGroupFilters.filter((function(t){return t!=e})):(t.enabledGroupFilters.push(e),t.enabledSpecialGroupFilters=[]),t.changeParams(t.params().sort)}},r.namePlural()))})),s.a.initializers.has("flarum-suspend")&&s.a.forum.attribute("hasSuspendPermission")&&(e.add("suspend",W.component({className:"GroupFilterButton",icon:"fas fa-ban",checked:"is:suspended"===this.enabledSpecialGroupFilters["flarum-suspend"],onclick:function(){var e="flarum-suspend";"is:suspended"===t.enabledSpecialGroupFilters[e]?t.enabledSpecialGroupFilters[e]="":(t.enabledSpecialGroupFilters[e]="is:suspended",t.enabledGroupFilters=[]),t.changeParams(t.params().sort)}},s.a.translator.trans("flarum-suspend.forum.user_badge.suspended_tooltip")),90),e.add("seperator",ct.a.component(),50)),e},r.actionItems=function(){var t=this,e=new b.a;return e.add("refresh",_.a.component({title:s.a.translator.trans("fof-user-directory.forum.page.refresh_tooltip"),icon:"fas fa-sync",className:"Button Button--icon",onclick:function(){t.state.refresh(),s.a.session.user&&(s.a.store.find("users",s.a.session.user.id()),m.redraw())}})),e},r.changeParams=function(t){var e=this.params();t===s.a.forum.attribute("userDirectoryDefaultSort")?delete e.sort:e.sort=t;var r="";for(var n in this.enabledSpecialGroupFilters)r+=this.enabledSpecialGroupFilters[n]+" ";if(this.enabledGroupFilters.length>0){var o=this.enabledGroupFilters.reduce((function(t,e){return t+(t?" ":"")+"group:"+e}),"");e.qBuilder={groups:o}}else e.qBuilder={groups:"",q:r.trim()};this.state.refreshParams(e);var a=p({},e);delete a.qBuilder,m.route.set(s.a.route("fof_user_directory",a))},r.stickyParams=function(){return{sort:m.route.param("sort"),q:m.route.param("q")}},r.params=function(){return this.stickyParams()},e}(v.a),ft=r(12),pt=r.n(ft),mt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).text=pt.a.attribute("text"),e}return h(e,t),e}(pt.a),dt={CheckableButton:W,SearchField:it,SmallUserCard:z,UserDirectoryList:K,UserDirectoryListItem:E,UserDirectoryPage:lt},ht={AbstractType:rt,GroupFilter:at,TextFilter:nt};s.a.initializers.add("fof-user-directory",(function(t){t.routes.fof_user_directory={path:"/users",component:lt},t.store.models["fof-user-directory-text"]=mt,Object(n.extend)(i.a.prototype,"view",(function(e,r){e&&!t.forum.attribute("userDirectoryDisableGlobalSearchSource")&&(r=r.toLowerCase(),e.splice(1,0,m("li",c.a.component({href:t.route("fof_user_directory",{q:r}),icon:"fas fa-search"},t.translator.trans("fof-user-directory.forum.search.users_heading",{query:r})))))})),Object(n.extend)(f.a.prototype,"navItems",(function(e){t.forum.attribute("canSeeUserDirectoryLink")&&e.add("fof-user-directory",c.a.component({href:t.route("fof_user_directory"),icon:"far fa-address-book"},t.translator.trans("fof-user-directory.forum.page.nav")),85)}))}))}]);
//# sourceMappingURL=forum.js.map